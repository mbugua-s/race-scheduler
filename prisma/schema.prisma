generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// -----------------------------
// Car Classes and Cars
// -----------------------------
model CarClass {
  id          Int          @id @default(autoincrement())
  name        String       @unique
  description String?
  cars        Car[]
  raceClasses RaceClass[]
}

model Car {
  id           Int      @id @default(autoincrement())
  name         String
  manufacturer String
  carClassId   Int

  carClass     CarClass @relation(fields: [carClassId], references: [id])
  raceClassCars RaceClassCar[]
}

// -----------------------------
// Tracks and Layouts
// -----------------------------
model Track {
  id        Int           @id @default(autoincrement())
  name      String
  country   String?
  layouts   TrackLayout[]
  schedules RaceSchedule[]
}

model TrackLayout {
  id        Int      @id @default(autoincrement())
  name      String
  lengthKm  Float?
  trackId   Int

  track     Track    @relation(fields: [trackId], references: [id])
  schedules RaceSchedule[]
}

// -----------------------------
// Race Schedules (core event)
// -----------------------------
model RaceSchedule {
  id               Int        @id @default(autoincrement())
  name             String
  date             DateTime
  description      String?
  trackId          Int
  layoutId         Int?

  // Entry requirements
  minDriverRating  Float?
  minSafetyRating  Float?

  // Race configuration
  maxTyres         Int?
  minDrivers       Int?
  maxDrivers       Int?
  practiceLength   Int?
  qualifyingLength Int?
  qualifyingType   QualifyingType @default(PUBLIC)
  setupType        SetupType      @default(OPEN)
  tireWarmers      TireWarmers    @default(ON)
  raceLength       Int?
  raceLengthType   RaceLengthType @default(TIME)

  track            Track       @relation(fields: [trackId], references: [id])
  layout           TrackLayout? @relation(fields: [layoutId], references: [id])
  raceClasses      RaceClass[]
}

// -----------------------------
// Race-Class Linking (multiclass support)
// -----------------------------
model RaceClass {
  id             Int        @id @default(autoincrement())
  raceScheduleId Int
  carClassId     Int

  raceSchedule   RaceSchedule @relation(fields: [raceScheduleId], references: [id])
  carClass       CarClass     @relation(fields: [carClassId], references: [id])
  allowedCars    RaceClassCar[]
}

// -----------------------------
// Specific Car Allow/Disallow Control
// -----------------------------
model RaceClassCar {
  id          Int      @id @default(autoincrement())
  raceClassId Int
  carId       Int
  allowed     Boolean  @default(true)

  raceClass   RaceClass @relation(fields: [raceClassId], references: [id])
  car         Car       @relation(fields: [carId], references: [id])

  @@unique([raceClassId, carId])
}

// -----------------------------
// Enums
// -----------------------------
enum QualifyingType {
  PUBLIC
  PRIVATE
}

enum SetupType {
  OPEN
  FIXED
}

enum TireWarmers {
  ON
  OFF
}

enum RaceLengthType {
  TIME
  LAPS
}