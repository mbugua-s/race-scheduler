generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// -----------------------------
// Car Classes and Cars
// -----------------------------
model CarClass {
  id          String       @id @default(uuid())
  name        String       @unique
  description String?
  cars        Car[]
  raceClasses RaceClass[]
}

model Car {
  id           String     @id @default(uuid())
  name         String
  manufacturer String
  carClassId   String

  carClass     CarClass   @relation(fields: [carClassId], references: [id])
  raceClassCars RaceClassCar[]
}

// -----------------------------
// Tracks and Layouts
// -----------------------------
model Track {
  id        String        @id @default(uuid())
  name      String
  country   String?
  layouts   TrackLayout[]
  schedules RaceSchedule[]
}

model TrackLayout {
  id        String     @id @default(uuid())
  name      String
  lengthKm  Float?
  trackId   String

  track     Track      @relation(fields: [trackId], references: [id])
  schedules RaceSchedule[]
}

// -----------------------------
// Race Schedules (core event)
// -----------------------------
model RaceSchedule {
  id               String       @id @default(uuid())
  name             String
  date             DateTime
  description      String?
  trackId          String
  layoutId         String?

  minDriverRating  Float?
  minSafetyRating  Float?

  maxTyres         Int?
  minDrivers       Int?
  maxDrivers       Int?
  practiceLength   Int?
  qualifyingLength Int?
  qualifyingType   QualifyingType @default(PUBLIC)
  setupType        SetupType      @default(OPEN)
  tireWarmers      TireWarmers    @default(ON)
  raceLength       Int?
  raceLengthType   RaceLengthType @default(TIME)

  track            Track         @relation(fields: [trackId], references: [id])
  layout           TrackLayout?   @relation(fields: [layoutId], references: [id])
  raceClasses      RaceClass[]
}

// -----------------------------
// Race-Class Linking (multiclass support)
// -----------------------------
model RaceClass {
  id             String      @id @default(uuid())
  raceScheduleId String
  carClassId     String

  raceSchedule   RaceSchedule @relation(fields: [raceScheduleId], references: [id])
  carClass       CarClass     @relation(fields: [carClassId], references: [id])
  allowedCars    RaceClassCar[]
}

// -----------------------------
// Specific Car Allow/Disallow Control
// -----------------------------
model RaceClassCar {
  id          String    @id @default(uuid())
  raceClassId String
  carId       String
  allowed     Boolean   @default(true)

  raceClass   RaceClass @relation(fields: [raceClassId], references: [id])
  car         Car       @relation(fields: [carId], references: [id])

  @@unique([raceClassId, carId])
}

// -----------------------------
// Enums
// -----------------------------
enum QualifyingType {
  PUBLIC
  PRIVATE
}

enum SetupType {
  OPEN
  FIXED
}

enum TireWarmers {
  ON
  OFF
}

enum RaceLengthType {
  TIME
  LAPS
}
